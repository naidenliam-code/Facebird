<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>FaceBird üê¶ - Quiz</title>

  <link rel="stylesheet" href="style.css">

  <!-- PWA / Manifest -->
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#1e73e8">
  <link rel="apple-touch-icon" href="icon-192.png">

  <link rel="icon" href="favicon.svg" type="image/svg+xml">
  <meta name="description" content="Quiz FaceBird : 15 questions, niveaux de difficult√©, badges et points.">
</head>
<body>
  <header>
    <h1>üéØ Quiz FaceBird</h1>
    <p>Teste tes connaissances sur les oiseaux !</p>
  </header>

  <nav>
    <a href="index.html">Accueil</a>
    <a href="feed.html">Fil</a>
    <a href="observations.html">Observations</a>
    <a class="active" href="quiz.html">Quiz</a>
    <a href="profil.html">Profil</a>
    <a href="map.html">Carte</a>
    <button id="theme-toggle" class="theme-toggle" type="button" aria-pressed="false">üåô Mode sombre</button>
  </nav>

  <main class="container">
    <div class="card" id="quiz-card">
      <h2>Quiz ‚ÄúOiseaux du quotidien‚Äù</h2>
      <p class="muted" id="best-score">Meilleur score : ‚Äî</p>
      <div id="quiz-box">
        <button class="btn" id="start-btn" type="button">‚ñ∂Ô∏è Commencer</button>
      </div>
    </div>
  </main>

  <footer>Cr√©√© par <b>Liam üëë</b></footer>

  <script src="theme.js" defer></script>
  <script src="badges.js" defer></script>
  <script src="points.js" defer></script>

  <!-- quiz.js int√©gr√© -->
  <script>
  (function(){
    const QKEY = 'fb-quiz-best';
    const $ = (sel) => document.querySelector(sel);

    const QUESTIONS = [
      { q: "Quel oiseau a une poitrine orange et est commun dans les jardins europ√©ens ?", choices: ["Moineau domestique", "Rouge-gorge", "Go√©land"], answer: 1, difficulty:"Facile" },
      { q: "Quel oiseau de ville est souvent confondu avec la tourterelle ?", choices: ["Pigeon ramier", "Corneille noire", "Faucon p√®lerin"], answer: 0, difficulty:"Facile" },
      { q: "Le merle noir est‚Ä¶", choices: ["Toujours brun", "M√¢le noir, femelle brune", "Toujours blanc"], answer: 1, difficulty:"Facile" },
      { q: "Quel oiseau nocturne a de grands yeux et chasse la nuit ?", choices: ["Hibou", "Hirondelle", "Pie"], answer: 0, difficulty:"Facile" },
      { q: "Quel oiseau accroche ses nids sous les toits au printemps ?", choices: ["Hirondelle", "Pingouin", "M√©sange"], answer: 0, difficulty:"Facile" },
      { q: "Quel oiseau marin plonge et peut rester longtemps sous l‚Äôeau ?", choices: ["Cormoran", "Moineau", "Pie"], answer: 0, difficulty:"Moyen" },
      { q: "Quel oiseau chante au lever du soleil et est symbole du matin ?", choices: ["Rossignol", "Coq", "M√©sange charbonni√®re"], answer: 1, difficulty:"Moyen" },
      { q: "Quel rapace est capable de fondre en piqu√© √† plus de 300 km/h ?", choices: ["Buse variable", "Faucon p√®lerin", "Aigle royal"], answer: 1, difficulty:"Moyen" },
      { q: "Quel petit oiseau jaune et vert est tr√®s pr√©sent en hiver aux mangeoires ?", choices: ["Chardonneret √©l√©gant", "Verdier", "Troglodyte mignon"], answer: 1, difficulty:"Moyen" },
      { q: "Quel oiseau a un bec rouge et noir, et niche souvent dans les clochers ?", choices: ["Cigogne blanche", "Huppe fasci√©e", "Tourterelle turque"], answer: 0, difficulty:"Moyen" },
      { q: "Quel oiseau imite les sons de son environnement, y compris d‚Äôautres oiseaux ?", choices: ["Geai des ch√™nes", "M√©sange bleue", "Pigeon ramier"], answer: 0, difficulty:"Difficile" },
      { q: "Quel oiseau migrateur vole chaque ann√©e de l‚ÄôArctique √† l‚ÄôAntarctique ?", choices: ["Sterne arctique", "Albatros hurleur", "Hirondelle rustique"], answer: 0, difficulty:"Difficile" },
      { q: "Quel oiseau rare a une huppe orange et noire et un cri ‚Äòoup-oup-oup‚Äô ?", choices: ["Huppe fasci√©e", "Pic √©peiche", "Ibis sacr√©"], answer: 0, difficulty:"Difficile" },
      { q: "Quel oiseau plane en V lors des migrations et √©met des cris sonores ?", choices: ["Grue cendr√©e", "Canard colvert", "Go√©land argent√©"], answer: 0, difficulty:"Difficile" },
      { q: "Quel oiseau de proie est l‚Äôembl√®me des √âtats-Unis ?", choices: ["Aigle royal", "Pygargue √† t√™te blanche", "Buse √† queue rousse"], answer: 1, difficulty:"Difficile" }
    ];

    const box = $('#quiz-box');
    const bestEl = $('#best-score');
    const startBtn = $('#start-btn');

    const loadBest = () => Number(localStorage.getItem(QKEY) || '0') || 0;
    const saveBest = (pct) => { const b=loadBest(); if (pct>b) localStorage.setItem(QKEY,String(pct)); };
    const renderBest = () => { const b=loadBest(); bestEl.textContent = b ? `Meilleur score : ${b}%` : 'Meilleur score : ‚Äî'; };

    function renderQuestion(i, picks){
      const q = QUESTIONS[i];
      box.innerHTML = `
        <p><b>Question ${i+1}/${QUESTIONS.length}</b> <span class="badge">${q.difficulty}</span></p>
        <p>${q.q}</p>
        <div id="choices"></div>
        <div style="display:flex;gap:10px;margin-top:10px">
          <button class="btn" id="prev" ${i===0?'disabled':''}>‚¨Ö Pr√©c√©dent</button>
          <button class="btn" id="next">${i===QUESTIONS.length-1?'Terminer ‚û°':'Suivant ‚û°'}</button>
        </div>
      `;
      const choices = document.querySelector('#choices');
      q.choices.forEach((c,idx)=>{
        const checked = picks[i]===idx ? 'checked' : '';
        choices.insertAdjacentHTML('beforeend', `
          <label style="display:block;margin:6px 0">
            <input type="radio" name="q${i}" value="${idx}" ${checked}> ${c}
          </label>
        `);
      });

      document.querySelector('#prev').addEventListener('click', ()=>{
        const sel = box.querySelector(`input[name="q${i}"]:checked`);
        if (sel) picks[i] = Number(sel.value);
        renderQuestion(i-1, picks);
      });
      document.querySelector('#next').addEventListener('click', ()=>{
        const sel = box.querySelector(`input[name="q${i}"]:checked`);
        if (sel) picks[i] = Number(sel.value);
        if (i===QUESTIONS.length-1) finish(picks);
        else renderQuestion(i+1, picks);
      });
    }

    function finish(picks){
      let correct = 0;
      QUESTIONS.forEach((q,i)=>{ if (picks[i]===q.answer) correct++; });
      const pct = Math.round((correct/QUESTIONS.length)*100);
      saveBest(pct);
      renderBest();
      box.innerHTML = `
        <h3>R√©sultat : ${correct}/${QUESTIONS.length} (${pct}%)</h3>
        <p class="muted">Tu peux recommencer pour am√©liorer ton meilleur score.</p>
        <button class="btn" id="restart">‚Üª Rejouer</button>
      `;
      document.querySelector('#restart').addEventListener('click', start);

      if (window.FB_BADGES){
        FB_BADGES.award('quiz_first');
        if (pct >= 80) FB_BADGES.award('quiz_80');
        if (pct === 100) FB_BADGES.award('quiz_perfect');
      }
      // points
      if (pct >= 100) FB_POINTS?.add('quiz_100');
      else if (pct >= 80) FB_POINTS?.add('quiz_80');
    }

    function start(){
      const picks = [];
      renderQuestion(0, picks);
      FB_POINTS?.add('quiz_play');
    }

    document.addEventListener('DOMContentLoaded', ()=>{
      renderBest();
      startBtn?.addEventListener('click', start);
    });
  })();
  </script>

  <script src="sw-register.js" defer></script>
  <script src="install-check.js" defer></script>
</body>
</html>
